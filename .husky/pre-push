#!/bin/sh

# Check if any workspace files have changed
echo "🔍 Checking for changes in workspaces..."

# Check if react-js has changes
if git diff --name-only HEAD~1 HEAD 2>/dev/null | grep -q '^react-js/' || git diff --name-only --cached | grep -q '^react-js/'; then
  echo "📦 Changes detected in react-js, running quality checks..."
  cd react-js
  npm run lint:check || exit 1
  npx tsc --noEmit || exit 1
  npm run build || exit 1
  cd ..
fi

# Check if react has changes (when it becomes available)
if git diff --name-only HEAD~1 HEAD | grep -q '^react/' && [ -f "react/package.json" ]; then
  echo "📦 Changes detected in react, running quality checks..."
  cd react
  npm run lint:check || exit 1
  npx tsc --noEmit || exit 1
  npm run build || exit 1
  cd ..
fi

# Validate manifest if it changed
if git diff --name-only HEAD~1 HEAD | grep -q 'manifest.json'; then
  echo "📋 Manifest changed, validating..."
  npm run validate-manifest || exit 1
fi

echo "✅ All pre-push checks passed!"
